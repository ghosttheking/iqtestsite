<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IQ Test</title>
<style>
  body{font-family:Arial,sans-serif;margin:0;padding:0;background:#f9f9f9;}
  #splash, #main, #howModal, #resultBlock{display:none;}
  .container{max-width:700px;margin:20px auto;padding:20px;background:white;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.1);}
  button, .pay-button{padding:10px 20px;border:none;border-radius:5px;cursor:pointer;font-size:16px;margin:5px;display:inline-block;text-decoration:none;color:white;}
  .btn-primary{background:#0b66ff;}
  .btn-secondary{background:#777;}
  .question-card{margin-bottom:20px;}
  .q-title{font-weight:bold;margin-bottom:10px;}
  .choices{display:flex;flex-direction:column;}
  .choice{padding:8px;margin-bottom:6px;border:1px solid #ccc;border-radius:4px;cursor:pointer;}
  .choice.selected{background:#0b66ff;color:white;border-color:#0b66ff;}
  #progressBar{background:#eee;width:100%;height:10px;border-radius:5px;margin-bottom:20px;overflow:hidden;}
  #progressFill{height:10px;width:0;background:#0b66ff;}
  #unlockArea, #postUnlockArea{margin-top:20px;}
  .pay-button{background:#28a745;}
  .small{font-size:0.9em;color:#555;}
  #howModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:1000;}
  #howModal .container{max-width:500px;}
  #closeModal{float:right;cursor:pointer;font-weight:bold;}
</style>
</head>
<body>

<div id="splash" class="container" style="display:block;">
  <h1>Welcome to the Ultimate IQ Test</h1>
  <p>Discover your IQ score with 35 questions!</p>
  <button id="startBtn" class="btn-primary">Start Test</button>
  <button id="startDemo" class="btn-secondary">How it works</button>
  <div id="resumeContainer"></div>
</div>

<div id="howModal">
  <div class="container">
    <span id="closeModal">&times;</span>
    <h2>How it works</h2>
    <p>Answer all 35 questions. At the end, unlock your full report.</p>
  </div>
</div>

<div id="main" class="container">
  <div id="progressBar"><div id="progressFill"></div></div>
  <div id="qcount"></div>
  <div id="quiz"></div>
  <button id="btnPrev" class="btn-secondary">Previous</button>
  <button id="btnNext" class="btn-primary">Next</button>
  <button id="btnFinish" class="btn-primary">Finish</button>
</div>

<div id="resultBlock" class="container">
  <h2>Your Test Results</h2>
  <p>Score: <span id="scoreText"></span></p>
  <p>Performance: <span id="performanceText"></span></p>
  <div id="unlockArea"></div>
  <div id="postUnlockArea" style="display:none;">
    <button id="btnIvePaid" class="btn-primary">I've paid</button>
  </div>
</div>

<script>
/* ---------- CONFIG ---------- */
const MP_LINK = "https://mpago.la/2UqEUEx"; // MercadoPago link
const STORAGE_KEY_ANS = 'iq_answers_final_v3';
const STORAGE_KEY_IDX = 'iq_index_final_v3';
const STORAGE_KEY_UNLOCKED = 'iq_unlocked_final_v3';
const STORAGE_KEY_PAID = 'iq_paid_final_v3';

/* ---------- QUESTIONS ---------- */
const QUESTIONS = [
  {q:"1. Which number comes next: 2, 4, 8, 16, ?", choices:["18","24","32","34"], correct:2},
  {q:"2. DOG is to MAMMAL as SWALLOW is to ?", choices:["FISH","BIRD","REPTILE","INSECT"], correct:1},
  {q:"3. Which does NOT belong: square, rectangle, circle, diamond?", choices:["square","rectangle","circle","diamond"], correct:2},
  {q:"4. Solve: 7 × 6 − 8 =", choices:["34","36","38","40"], correct:0},
  {q:"5. Which word does not fit: pen, pencil, notebook, ruler?", choices:["pen","pencil","notebook","ruler"], correct:2},
  {q:"6. If today is Tuesday, what day will it be in 3 days?", choices:["Friday","Thursday","Saturday","Wednesday"], correct:2},
  {q:"7. Next number: 1,1,2,3,5,8,?", choices:["10","11","12","13"], correct:3},
  {q:"8. If all roses are flowers and some flowers wilt, can we say all roses wilt?", choices:["Yes","No","Sometimes","Impossible to know"], correct:1},
  {q:"9. Synonym of 'fast'?", choices:["Slow","Quick","Weak","Morbid"], correct:1},
  {q:"10. Train leaves at 10 and travels 120 km in 2 hours. Average speed?", choices:["40 km/h","50 km/h","60 km/h","70 km/h"], correct:2},
  {q:"11. If A > B and B > C, then A is ____ C.", choices:["smaller than","greater than","equal to","not related"], correct:1},
  {q:"12. Complete the rhyme: 'Cat on the roof, mouse on the ___.'", choices:["peak","hole","bread","frog"], correct:0},
  {q:"13. Which number is prime?", choices:["21","29","27","33"], correct:1},
  {q:"14. If tomorrow is Thursday, what day is today?", choices:["Friday","Wednesday","Tuesday","Sunday"], correct:1},
  {q:"15. How many sides does a hexagon have?", choices:["5","6","7","8"], correct:1},
  {q:"16. If 5 shirts cost 100, how much is one?", choices:["10","15","20","25"], correct:2},
  {q:"17. Analogy: 'Key is to door' as 'pen is to ___'", choices:["paper","book","ink","writing"], correct:3},
  {q:"18. Solve: (9 + 3) ÷ 3 =", choices:["2","3","4","6"], correct:2},
  {q:"19. Which figure follows: circle, square, circle, square, ?", choices:["circle","triangle","rectangle","pentagon"], correct:0},
  {q:"20. If 2x = 10, x = ?", choices:["4","5","6","8"], correct:1},
  {q:"21. Opposite of 'optimistic'?", choices:["positive","pessimistic","happy","active"], correct:1},
  {q:"22. What number is missing: 10, 7, 4, ?, -2", choices:["1","0","-1","2"], correct:0},
  {q:"23. If 3=C, 1=A, 20=T, what word is 20-1-3-8-15?", choices:["TACHO","TACOS","TACOH","TACOS"], correct:1},
  {q:"24. Result of 12 - (3×2)?", choices:["4","6","8","10"], correct:2},
  {q:"25. Which letter completes: A, C, E, G, ?", choices:["I","H","J","K"], correct:0},
  {q:"26. Map scale: 1 cm = 10 km. 3 cm = ? km", choices:["10","20","30","40"], correct:2},
  {q:"27. Which is greater: 0.75 or 3/4?", choices:["0.75","3/4","they are equal","not possible"], correct:2},
  {q:"28. Which is an even number?", choices:["13","22","37","49"], correct:1},
  {q:"29. If a train travels 60 km/h for 2 hours, how far?", choices:["100 km","110 km","120 km","130 km"], correct:2},
  {q:"30. Synonym of 'happy'?", choices:["Sad","Joyful","Angry","Lazy"], correct:1},
  {q:"31. Which shape has 3 sides?", choices:["Square","Triangle","Rectangle","Circle"], correct:1},
  {q:"32. Solve: 5 + 7 × 2", choices:["19","24","14","26"], correct:0},
  {q:"33. Which number is smallest?", choices:["0.9","0.99","0.909","0.89"], correct:3},
  {q:"34. If John is taller than Mike and Mike is taller than Tom, who is shortest?", choices:["John","Mike","Tom","Cannot know"], correct:2},
  {q:"35. Complete series: 2, 4, 8, 16, 32, ?", choices:["48","64","62","50"], correct:1}
];

/* ---------- STATE ---------- */
let index = parseInt(localStorage.getItem(STORAGE_KEY_IDX)) || 0;
let answers = JSON.parse(localStorage.getItem(STORAGE_KEY_ANS)) || Array(35).fill(null);
let unlocked = localStorage.getItem(STORAGE_KEY_UNLOCKED)==='true';
let paid = localStorage.getItem(STORAGE_KEY_PAID)==='true';

/* ---------- ELEMENTS ---------- */
const quizEl=document.getElementById('quiz');
const qcountEl=document.getElementById('qcount');
const progressFillEl=document.getElementById('progressFill');
const btnPrev=document.getElementById('btnPrev');
const btnNext=document.getElementById('btnNext');
const btnFinish=document.getElementById('btnFinish');
const startBtn=document.getElementById('startBtn');
const startDemo=document.getElementById('startDemo');
const splash=document.getElementById('splash');
const mainSection=document.getElementById('main');
const resumeContainer=document.getElementById('resumeContainer');
const howModal=document.getElementById('howModal');
const closeModal=document.getElementById('closeModal');
const unlockArea=document.getElementById('unlockArea');
const postUnlockArea=document.getElementById('postUnlockArea');
const btnIvePaid=document.getElementById('btnIvePaid');
const resultBlock=document.getElementById('resultBlock');
const scoreText=document.getElementById('scoreText');
const performanceText=document.getElementById('performanceText');

/* ---------- HELPERS ---------- */
function saveProgress(){ localStorage.setItem(STORAGE_KEY_ANS,JSON.stringify(answers)); localStorage.setItem(STORAGE_KEY_IDX,String(index)); }
function clearProgress(){ localStorage.removeItem(STORAGE_KEY_ANS); localStorage.removeItem(STORAGE_KEY_IDX); localStorage.removeItem(STORAGE_KEY_UNLOCKED); localStorage.removeItem(STORAGE_KEY_PAID); unlocked=paid=false; }
function classification(score){ return score>=30?'Genius':score>=25?'Above average':score>=18?'Average':'Below average'; }

/* ---------- CONFETTI ---------- */
function launchConfetti(){ for(let i=0;i<80;i++){ const d=document.createElement('div'); d.style.position='fixed'; d.style.width='6px'; d.style.height='6px'; d.style.background=['#ff4c4c','#ff9900','#63a4ff','#0b66ff'][Math.floor(Math.random()*4)]; d.style.left=Math.random()*window.innerWidth+'px'; d.style.top='-10px'; d.style.opacity=1; d.style.zIndex=2000; d.style.borderRadius='50%'; document.body.appendChild(d); const fall=setInterval(()=>{ const t=parseFloat(d.style.top); d.style.top=t+Math.random()*7+2+'px'; d.style.left=parseFloat(d.style.left)+Math.random()*6-3+'px'; d.style.opacity-=0.01; if(d.style.opacity<=0){ d.remove(); clearInterval(fall); } },16); }}

/* ---------- RENDER ---------- */
function renderQuestion(){
  quizEl.innerHTML='';
  const q=QUESTIONS[index];
  const card=document.createElement('div'); card.className='question-card';
  const title=document.createElement('div'); title.className='q-title'; title.textContent=q.q; card.appendChild(title);
  const choices=document.createElement('div'); choices.className='choices';
  q.choices.forEach((c,i)=>{ const ch=document.createElement('div'); ch.className='choice'; ch.tabIndex=0; ch.textContent=c; ch.dataset.index=i; if(answers[index]===i)ch.classList.add('selected'); ch.addEventListener('click',()=>{ answers[index]=i; choices.querySelectorAll('.choice').forEach(x=>x.classList.remove('selected')); ch.classList.add('selected'); saveProgress(); }); ch.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' ') ch.click(); }); choices.appendChild(ch); });
  card.appendChild(choices); quizEl.appendChild(card);
  qcountEl.textContent=`Question ${index+1} of ${QUESTIONS.length}`;
  progressFillEl.style.width=`${Math.round((index+1)/QUESTIONS.length*100)}%`;
  btnPrev.style.display=index===0?'none':'inline-block';
  btnNext.style.display=index===QUESTIONS.length-1?'none':'inline-block';
  btnFinish.style.display=index===QUESTIONS.length-1?'inline-block':'none';
}

/* ---------- NAV ---------- */
btnNext.addEventListener('click',()=>{ if(answers[index]===null){ alert('Select an answer first.'); return; } if(index<QUESTIONS.length-1){ index++; saveProgress(); renderQuestion(); }});
btnPrev.addEventListener('click',()=>{ if(index>0){ index--; saveProgress(); renderQuestion(); }});
btnFinish.addEventListener('click',()=>{ if(answers[index]===null){ alert('Select an answer.'); return; } showResults(); });

/* ---------- START/RESUME ---------- */
function injectResumeBanner(){ resumeContainer.innerHTML=''; if(answers.some(a=>a!==null)){ const banner=document.createElement('div'); banner.innerHTML=`<strong>Unfinished test found.</strong> <button id="btnResume" class="btn-secondary" style="margin-left:8px">Resume</button> <button id="btnRestart" class="btn-secondary" style="margin-left:8px">Start Over</button>`; resumeContainer.appendChild(banner); document.getElementById('btnResume').addEventListener('click',()=>{ splash.style.display='none'; mainSection.style.display='block'; renderQuestion(); }); document.getElementById('btnRestart').addEventListener('click',()=>{ if(!confirm('Clear progress?')) return; answers=Array(QUESTIONS.length).fill(null); index=0; clearProgress(); splash.style.display='none'; mainSection.style.display='block'; renderQuestion(); }); } }
startBtn.addEventListener('click',()=>{ splash.style.display='none'; mainSection.style.display='block'; renderQuestion(); });
startDemo.addEventListener('click',()=>{ howModal.style.display='flex'; });
closeModal.addEventListener('click',()=>{ howModal.style.display='none'; });
window.addEventListener('click',(e)=>{ if(e.target===howModal) howModal.style.display='none'; });

/* ---------- RESULTS/UNLOCK ---------- */
function showResults(){
  let score=0; for(let i=0;i<QUESTIONS.length;i++) if(answers[i]===QUESTIONS[i].correct) score++;
  scoreText.textContent=`${score}/${QUESTIONS.length}`;
  performanceText.textContent=classification(score);
  resultBlock.style.display='block'; progressFillEl.style.width='100%';
  renderUnlockArea();
  localStorage.setItem(STORAGE_KEY_ANS,JSON.stringify(answers));
  localStorage.removeItem(STORAGE_KEY_IDX);
}

function renderUnlockArea(){
  unlockArea.innerHTML='';
  if(!unlocked){
    const info=document.createElement('div');
    info.innerHTML=`<div class="small" style="margin-bottom:10px">Discover your full report for <strong>$13</strong> (originally $50).</div>`;
    const unlockBtn=document.createElement('a'); unlockBtn.className='pay-button'; unlockBtn.href='#'; unlockBtn.textContent='Unlock for $13';
    unlockBtn.addEventListener('click',(e)=>{ e.preventDefault(); showPaymentOptions(); unlocked=true; localStorage.setItem(STORAGE_KEY_UNLOCKED,'true'); });
    info.appendChild(unlockBtn); unlockArea.appendChild(info);
  } else showPaymentOptions();
}

function showPaymentOptions(){
  unlockArea.innerHTML='';
  const note=document.createElement('div'); note.className='small'; note.style.marginBottom='8px';
  note.textContent='Complete payment using the link below. After payment, click "I\'ve paid" to view your full report.';
  const payLink=document.createElement('a'); payLink.className='pay-button'; payLink.href=MP_LINK; payLink.target='_blank'; payLink.rel='noopener'; payLink.textContent='Pay $13 & Unlock';
  unlockArea.appendChild(note); unlockArea.appendChild(payLink);
  postUnlockArea.style.display='block';
}

btnIvePaid.addEventListener('click',()=>{
  paid=true; localStorage.setItem(STORAGE_KEY_PAID,'true'); launchConfetti(); alert('Payment confirmed! Full report unlocked.');
});

injectResumeBanner();
</script>

</body>
</html>